apiVersion: v1
kind: List
items:
# -------------------------------------------------------------------
#  Persistent Volume Claim: Requests storage for our config files.
# -------------------------------------------------------------------
- apiVersion: v1
  kind: PersistentVolumeClaim
  metadata:
    name: s3-ui-config-pvc
  spec:
    accessModes:
      - ReadWriteOnce
    resources:
      requests:
        storage: 1Gi # 1 Gibibyte is plenty for config files

# -------------------------------------------------------------------
#  Deployment: Deploys the application and mounts the volume.
# -------------------------------------------------------------------
- apiVersion: apps/v1
  kind: Deployment
  metadata:
    name: s3-ui
    labels:
      app: s3-ui
  spec:
    replicas: 1
    selector:
      matchLabels:
        app: s3-ui
    template:
      metadata:
        labels:
          app: s3-ui
      spec:
        containers:
          - name: s3-ui
            image: quay.io/jhurlocker/s3ui:latest 
            ports:
              - containerPort: 5001
            volumeMounts:
              - name: config-volume
                mountPath: /data/config # Mount the PVC to the config directory
        volumes:
          - name: config-volume
            persistentVolumeClaim:
              claimName: s3-ui-config-pvc # Link to the PVC created above

# -------------------------------------------------------------------
#  Service and Route (for access)
# -------------------------------------------------------------------
- apiVersion: v1
  kind: Service
  metadata:
    name: s3-ui-service
  spec:
    selector:
      app: s3-ui
    ports:
      - protocol: TCP
        port: 80
        targetPort: 5001

- apiVersion: route.openshift.io/v1
  kind: Route
  metadata:
    name: s3-ui-route
  spec:
    to:
      kind: Service
      name: s3-ui-service
    port:
      targetPort: 5001
    tls:
      termination: edge
      insecureEdgeTerminationPolicy: Redirect
    wildcardPolicy: None
