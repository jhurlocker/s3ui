{% extends "base.html" %}
{% block content %}
<nav aria-label="breadcrumb">
  <ol class="breadcrumb">
    <li class="breadcrumb-item"><a href="{{ url_for('index') }}">Buckets</a></li>
    <li class="breadcrumb-item"><a href="{{ url_for('view_bucket', bucket_name=bucket_name) }}">{{ bucket_name }}</a></li>
    <li class="breadcrumb-item active" aria-current="page">Polling Notifications</li>
  </ol>
</nav>

<div class="card">
    <div class="card-header">
        <h3><i class="fas fa-sync-alt"></i> Bucket Polling Configuration</h3>
    </div>
    <div class="card-body">
        <p>Enable the built-in poller to monitor this bucket for changes. When an object is created or deleted, a notification will be sent to the webhook URL you provide.</p>
        <div class="alert alert-info" role="alert">
            <strong>How it works:</strong> A background thread in this application periodically scans the bucket for new, modified, or deleted files and sends a JSON payload to your endpoint. This works with any S3-compatible service.
        </div>
        
        <form method="post" action="{{ url_for('configure_notifications', bucket_name=bucket_name) }}">
            <div class="mb-3">
                <label for="webhook_url" class="form-label">Webhook URL</label>
                <input type="url" class="form-control" id="webhook_url" name="webhook_url" value="{{ config.webhook_url or '' }}" required placeholder="https://your-endpoint.com/webhook">
                <div class="form-text">
                    The endpoint that will receive the HTTP POST notifications.
                </div>
            </div>
            <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Enable / Save Configuration</button>
        </form>

        {% if config.enabled %}
        <hr>
        <p>Polling is currently <strong>enabled</strong> for this bucket.</p>
        <form method="post" action="{{ url_for('configure_notifications', bucket_name=bucket_name) }}">
            <input type="hidden" name="action" value="disable">
            <button type="submit" class="btn btn-warning"><i class="fas fa-toggle-off"></i> Disable Polling</button>
        </form>
        {% else %}
        <hr>
        <p>Polling is currently <strong>disabled</strong> for this bucket.</p>
        {% endif %}
    </div>
</div>
{% endblock %}